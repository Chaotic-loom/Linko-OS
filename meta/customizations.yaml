---
name: customizations
mmdebstrap:
  packages:
    - plymouth
    - plymouth-themes
    - dosfstools
    - e2fsprogs
    - fdisk
    - openjdk-17-jdk-headless
    - libgl1-mesa-dri
    - libegl1-mesa
    - libxrandr2
    - libxinerama1
    - libwayland-client0
    - libwayland-cursor0
    - libwayland-egl1
    - libwayland-server0
    - libxkbcommon0
    - libxcursor1
    - libxi6
    - libopenal1
    - libopenal-dev
    - libopenal-data
    - libasound2
    - libasound2-dev
    - libdrm2
    - libgbm1
    - libglu1-mesa
    - libudev1
    - libudev-dev
    - cage
    - firmware-brcm80211
    - wpasupplicant
    - network-manager
    - network-manager-configs
    - dbus
    - git
  install-recommends: false
  customize-hooks:
    # Disable systemd-networkd first
    - chroot $1 systemctl disable systemd-networkd.service
    - chroot $1 systemctl mask systemd-networkd.service

    # Enable NetworkManager
    - chroot $1 systemctl enable NetworkManager.service

    # Ensure proper resolv.conf handling
    - chroot $1 ln -sf /run/NetworkManager/resolv.conf /etc/resolv.conf
